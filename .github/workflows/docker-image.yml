name: Docker Image CI

on:
  release:
    types: [created]
  push:
    branches: [ "master" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - name: Login to Yandex Cloud
      id: login-cr
      uses: yc-actions/yc-cr-login@v2
      with:
          yc-sa-json-credentials: ${{ secrets.YANDEX_CLOUD_KEY }} # Ensure this secret is set in your repository settings
    
    - name: Set Image Tag
      id: set_tag
      run: echo "IMAGE_TAG=$(date +%s)" >> $GITHUB_ENV

    - name: Build the Docker image
      run: |
        docker build --tag cr.yandex/crpe51e4v7vs5p6ahf5m/go-uuid:e722547a578669d5b09701e4d83967c7d11f28ef .
        docker push cr.yandex/crpe51e4v7vs5p6ahf5m/go-uuid:e722547a578669d5b09701e4d83967c7d11f28ef